func (raft *Raft) loop() {
    state := follower; // begin life as a follower

    for {
        switch (state)  {
        case follower: state = raft.follower()
        case candidate: state = raft.candidate()
        case leader: state = raft.leader()
        default: return
        }
    }
}

raft.follower() {
    start timer // to become candidate if no append reqs
    for {
        event := <- eventCh
        switch event {
        case ClientAppend:
            // Do not handle clients in follower mode. Send it back up the
            // pipe with committed = false
            ev.logEntry.commited = false
            commitCh <- ev.logentry
        case VoteRequest:
            msg = event.msg
            if msg.term < currentterm, respond with 
            if msg.term > currentterm, upgrade currentterm
            if not already voted in my term
                reset timer
                reply ok to event.msg.serverid
                remember term, leader id (either in log or in separate file)
        case AppendRPC:
            reset timer
            if msg.term < currentterm, ignore
            reset heartbeat timer
            upgrade to event.msg.term if necessary
            if prev entries of my log and event.msg match
               add to disk log
               flush disk log
               respond ok to event.msg.serverid
            else
               respond err.
        case Timeout : return candidate  // new state back to loop()
    }
}

raft.leader() {
}

raft.candidate() {
}
